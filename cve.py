import requests
import json
import os
import re

from dotenv import load_dotenv

load_dotenv()
key=os.getenv('VULDB_API_KEY')


# Set HTTP Header
userAgent = 'VulDB API Advanced Python Demo Agent'
headers = {'User-Agent': userAgent, 'X-VulDB-ApiKey': key}

# URL VulDB endpoint
url = 'https://vuldb.com/?api'

# Choose the API call based on the passed arguments
# Default call is the last 5 recent entries
postData = {'search': 'Exiv2'}

# Get API response
response = requests.post(url, headers=headers, data=postData)

l = []
# Display result if everything went OK
if response.status_code == 200:
    # Parse HTTP body as JSON
    responseJson = json.loads(response.content)

    # Output
    for i in responseJson['result']:
        title = i['entry']['title']
        match = re.search(r'\b\d+(\.\d+)*\b',title)
        if match:
            version = match.group(0)
        else:
            continue
        l.append(version)

print(l)
m = max(l)
print(m)