import os 
import subprocess
import sys

lines_lst = []
word = 'SUMMARY: '
toChatGPT_parse = ""

with open(r'output', 'r') as fp:
    lines = fp.readlines()
    for line in lines:
        toChatGPT_parse += line
        if line.find(word) != -1:
            lines_lst.append(line)

'''
for l in lines_lst:
    tokens = l.split(" ")
    codefile = tokens[3]
    codefile = codefile[:codefile.find(':')]
'''

codefile = sys.argv[1]

print("SEND THIS TO CHAT GPT:\n")
print(toChatGPT_parse)

'''
now the result of chatGPT should return [vuln_name, line_no, func_name]
'''

res = ["Heap overflow", "8", "main"]

print("This code below has a " + res[0] + " vulenrability in the function " + res[2] + " at line number " + res[1] +". Fix that. \n")

src_code = ""

with open(codefile, 'r') as fp:
    src_tmp = fp.readlines()
    src_code = ''.join(src_tmp)

print(src_code)



'''
prompt = []
src_code = ""
vuln_name = ""

for l in lines_lst:
    tokens = l.split(" ")
    codefile = tokens[3]
    codefile = codefile[:codefile.find(":")]
    vuln_name = tokens[2]      
    with open(codefile, 'r') as fp:
          src_tmp = fp.readlines()
          src_code = ''.join(src_tmp)
    prompt.append("This code below has a " + vuln_name + " vulnerabililty. Fix that. \n" + src_code + "\n")

prompt = list(set(prompt))
for msg in prompt:
    print(msg)
'''
