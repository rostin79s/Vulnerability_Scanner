import requests
import json
import os
import re
from distutils.version import StrictVersion

from dotenv import load_dotenv

def main(name,ver):

    load_dotenv()
    key=os.getenv('VULDB_API_KEY')


    # Set HTTP Header
    userAgent = 'VulDB API Advanced Python Demo Agent'
    headers = {'User-Agent': userAgent, 'X-VulDB-ApiKey': key}

    # URL VulDB endpoint
    url = 'https://vuldb.com/?api'

    # Choose the API call based on the passed arguments
    # Default call is the last 5 recent entries
    postData = {'search': name}

    # Get API response
    response = requests.post(url, headers=headers, data=postData)

    l = []
    # Display result if everything went OK
    if response.status_code == 200:
        # Parse HTTP body as JSON
        responseJson = json.loads(response.content)

        # Output
        for i in responseJson['result']:
            title = i['entry']['title']
            match = re.search(r'\b\d+(\.\d+)*\b',title)
            if match:
                version = match.group(0)
            else:
                continue
            l.append(version)

    m = max(l)
    if StrictVersion(ver)<=StrictVersion(m):
        return True
    return False

if __name__ == "__main__":
    main(name="",ver="")